{"version":3,"names":["_mapReactionToStorable","require","_QuickSqliteClient","_createUpsertQuery","insertReaction","_ref","_ref$flush","flush","reaction","queries","storableReaction","mapReactionToStorable","push","createUpsertQuery","message_id","QuickSqliteClient","logger","executeSqlBatch","exports"],"sources":["insertReaction.ts"],"sourcesContent":["import type { ReactionResponse } from 'stream-chat';\n\nimport { mapReactionToStorable } from '../mappers/mapReactionToStorable';\nimport { QuickSqliteClient } from '../QuickSqliteClient';\nimport { createUpsertQuery } from '../sqlite-utils/createUpsertQuery';\nimport type { PreparedQueries } from '../types';\n\nexport const insertReaction = ({\n  flush = true,\n  reaction,\n}: {\n  reaction: ReactionResponse;\n  flush?: boolean;\n}) => {\n  const queries: PreparedQueries[] = [];\n\n  const storableReaction = mapReactionToStorable(reaction);\n\n  queries.push(createUpsertQuery('reactions', storableReaction));\n\n  queries.push([\n    'UPDATE messages SET reactionCounts = reactionCounts + 1 WHERE id = ?',\n    [reaction.message_id],\n  ]);\n\n  QuickSqliteClient.logger?.('info', 'insertReaction', {\n    flush,\n    reaction: storableReaction,\n  });\n\n  if (flush) {\n    QuickSqliteClient.executeSqlBatch(queries);\n  }\n\n  return queries;\n};\n"],"mappings":";;;;AAEA,IAAAA,sBAAA,GAAAC,OAAA;AACA,IAAAC,kBAAA,GAAAD,OAAA;AACA,IAAAE,kBAAA,GAAAF,OAAA;AAGO,IAAMG,cAAc,GAAG,SAAjBA,cAAcA,CAAAC,IAAA,EAMrB;EAAA,IAAAC,UAAA,GAAAD,IAAA,CALJE,KAAK;IAALA,KAAK,GAAAD,UAAA,cAAG,IAAI,GAAAA,UAAA;IACZE,QAAQ,GAAAH,IAAA,CAARG,QAAQ;EAKR,IAAMC,OAA0B,GAAG,EAAE;EAErC,IAAMC,gBAAgB,GAAG,IAAAC,4CAAqB,EAACH,QAAQ,CAAC;EAExDC,OAAO,CAACG,IAAI,CAAC,IAAAC,oCAAiB,EAAC,WAAW,EAAEH,gBAAgB,CAAC,CAAC;EAE9DD,OAAO,CAACG,IAAI,CAAC,CACX,sEAAsE,EACtE,CAACJ,QAAQ,CAACM,UAAU,CAAC,CACtB,CAAC;EAEFC,oCAAiB,CAACC,MAAM,oBAAxBD,oCAAiB,CAACC,MAAM,CAAG,MAAM,EAAE,gBAAgB,EAAE;IACnDT,KAAK,EAALA,KAAK;IACLC,QAAQ,EAAEE;EACZ,CAAC,CAAC;EAEF,IAAIH,KAAK,EAAE;IACTQ,oCAAiB,CAACE,eAAe,CAACR,OAAO,CAAC;EAC5C;EAEA,OAAOA,OAAO;AAChB,CAAC;AAACS,OAAA,CAAAd,cAAA,GAAAA,cAAA"}